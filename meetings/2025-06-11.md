# Progress update 5
**Date**: 11/06/2025 <br>
**Time**: 14:00-15:00

## Roadmap
- Timeline
    - June: 
        > Progress update 5:
        -     Wednesday 11 @ 14:00-15:00
    - July
        > Another progress meeting?
        -     Earlier in in the month, needs to be scheduled
        > Progress update 6 (final update before green light): 
        -     Wednesday 16 @ 15:00-16:00 (Alexander might not be here)
        -     Wednesday 23rd @ 14:00-15:00 (opt. 1)
        -     Thursday 24th @ 10:00-11:00 (opt. 2)
        > Green light option <span style="color:#6fbf73"> Friday 25th @ ?
        </span>
    - August:
        > Green light option (originally denied in the first date poll, but that was in the afternoon)
        -     Friday 1st @ 10:00-11:00 (opt. 3)
    - September:
        > Defense
        -     T.B.A. (depends on green light and availability of committee members)

 
## Progress update
- Implemented [diffusion problem](../lib/problems/diffusion.py) on [triangulation of rectangular domain](../lib/meshes/mesh.py) with DBCs, (sparse) CG solver and used [1-OAS and 2-OAS](../lib/preconditioners/preconditioners.py) (+ Q1, GDSW, RGDSW, AMS [coarse spaces](../lib/preconditioners/coarse_space.py)) for 
$$
f=\begin{cases}
    1, & \text{constant} \\
    32 \cdot(y\cdot(l_y - y) + x\cdot(l_x - x)), & \text{parabolic} \\
\end{cases}
$$
$$
\mathcal{C}=
\begin{cases}
    1, & \text{constant} \\
    10^8 \text{ on interface vertices}, & \text{Cumaru \& Heinlein 2024}\\
    1.2 + \cos(32 \cdot \pi \cdot x \cdot (1 - x) \cdot y \cdot (1 - y))^{-1}, & \text{eq. 5.6 from Hetmaniuk \& Lehoucq (2010)}\\
    ((2 + 1.8 \cdot s_x) / (2 + 1.8 \cdot c_y)) + ((2 + s_y) / (2 + 1.8 \cdot s_x)), &\text{eq. 5.8 from Hetmaniuk \& Lehoucq (2010)}\\
    c = ((2 + 1.99 \cdot s_x) / (2 + 1.99 \cdot s_y)) + ((2 + s_y) / (2 + 1.99 \cdot s_x)), &\text{eq. 4.36 from Heinlein (2016)}\\
\end{cases}
$$ 
- Made eigenpectra $\sigma(M^{-1}A)$ for [first](../figures/spectra_constant.pdf) and [second](../figures/spectra_inclusions.pdf) cases.
- Studied performance of multi-cluster CG iteration bound for [the two-cluster case](../figures/performance_vs_condition_number.pdf)
- Notes about the performance plot
    - Smaller left cluster widths result in overall better performance with a maximum improvement on the order of 10^4 
    - Smaller right cluster condition number $k_n$ also results in better performance; $$\max_{k_n=10} p = 10^4$$ and $$\max_{k_n=100} p = 10^3$$
    - For the spectrum of our [model problem](../figures/spectra_inclusions.pdf); smallest eigenvalue on the order of the contrast of $\mathcal{C} \approx \lambda_1 = 10^{-8}$ and a left cluster width of $w_1 = 10^{-7}$ the new bound performs nicely with $p\approx 10^3$
- For a uniform spectrum ($a<b=c<d$) with $\kappa_n = \frac{d}{b}= \text{constant}$, the bound
$$
     \bar{m}=\left\lceil\frac{1}{2} \sqrt{\kappa_n} \ln (2 / \epsilon)+\left(1+\frac{1}{2} \sqrt{\kappa_n} \ln (4 d / b)\right) p\right\rceil,
$$
reduces to 
$$
    \bar{m}=\left\lceil\frac{1}{2} \sqrt{\kappa_n} \ln (2 / \epsilon)+1+\frac{1}{2} \underbrace{\sqrt{\color{green}{\kappa_1}}}_{=\sqrt{\textcolor{green}{\kappa}/\kappa_n}} \ln(2/\epsilon) + \frac{1}{2} \sqrt{\kappa_n} \ln (4 \kappa_n) + \frac{1}{4} \sqrt{\textcolor{green}{\kappa}} \ln (4 \kappa_n)\right\rceil, \tag{1}
$$
where $\kappa_1 = \frac{b}{a}$ and $\kappa=\frac{d}{a}$. 
- So for a uniform spectrum, the new bound is worse by constant factor (made up of all the constant terms in eq. 1 above) as well as a factor that grows with $\sqrt{\textcolor{green}{\kappa}}$.
- Reducing eq. (1) further we get that the number of iterations predicted by the sharpened bound grows as 
$$
    \frac{1}{2}\sqrt{\kappa_n}\ln\left(\frac{\kappa_n}{2\epsilon}\right) + \textcolor{green}{\sqrt{\kappa}} \left(\frac{1}{2\sqrt{\kappa_n}} + \frac{1}{4}\ln(4\kappa_n)\right)\ln(2/\epsilon)
$$,
where $c$ is the sum of all the constant values in (1).
- Note, $m_c \sim \sqrt{\kappa}\ln(2/\epsilon)$. Hence, the minimal performance satisfies
$$
p_{\text{min}}(\kappa_1, \kappa_n) = \min_{\kappa, \ \kappa_n=c, \kappa_1 = \frac{\kappa}{\kappa_n}} m_c/m_s = \left(\frac{1}{2\sqrt{\kappa_n}} + \frac{1}{4}\ln(4\kappa_n) + \sqrt{\kappa_1}\ln\left(\frac{\kappa_n}{4}\right)\right)^{-1},
$$
Now, setting $q(\kappa_1,\kappa_n) = \frac{1}{4}\ln(4\kappa_n) + \sqrt{\kappa_1}\ln\left(\frac{\kappa_n}{4}\right)$ and using the Taylor expansion for $\frac{1}{1 + x} \approx 1 - x + \mathcal{O}(x^2)$ for small $x = \frac{1}{2q(\kappa_1,\kappa_n)\sqrt{\kappa_n}}$ we get
$$
p_{\text{min}}(\kappa_1, \kappa_n) = q(\kappa_1,\kappa_n)^{-1} - \frac{1}{2q(\kappa_1,\kappa_n)^2\sqrt{\kappa_n}} + \mathcal{O}\left(\frac{1}{4q(\kappa_1,\kappa_n)^3\kappa_n}\right)
$$
- Now expanding $q^{-1}(\kappa_1,\kappa_n)$ with the same Taylor expansion and $x=\frac{\ln(4\kappa_n)}{4\sqrt{\kappa_1}\ln\frac{\kappa_n}{4}}$
$$
q(\kappa_1,\kappa_n)^{-1} = (4\sqrt{\kappa_1}\ln(4\kappa_n))^{-1} - \frac{\ln(4\kappa_n)}{16\kappa_1\ln(\frac{\kappa_n}{4})^2} + \mathcal{O}\left(\frac{\ln(4\kappa_n)}{32\kappa^{3/2}_1\ln(\frac{\kappa_n}{4})^3}\right)
$$
- Combining the two expansions we get
$$
p_{\text{min}}(\kappa_1, \kappa_n) = (4\sqrt{\kappa_1}\ln(4\kappa_n))^{-1} + \mathcal{O}\left(\frac{1}{32\kappa_1\sqrt{\kappa_n}\ln(4\kappa_n)^2}\right)
$$
- Since $\kappa_1,\kappa_n \geq 1$ we neglect the higher order terms  we get
$$
p_{\text{min}}(\kappa_1, \kappa_n) \approx (4\sqrt{\kappa_1}\ln(4\kappa_n))^{-1} \tag{2}
$$
- Eq. (2) explains the performance curve for the uniform spectra in the [performance plot](../figures/performance_vs_condition_number.pdf), as the minimum performance is largely independent of condition number. Only for small $\kappa_1 \sim \kappa$ do we notice a slight increase (notice the little increase of the same performance curve for small $\kappa$). Additionally, Eq. (2) shows that for increasing $\kappa_n$ we expect a decreasing minimum performance $p_{\text{min}}$. 
- Indeed, considering the ratio in $p_{\text{min}}$ 
$$
    r = \frac{p_{\text{min}}(\kappa_1, \kappa_n=c_1)}{p_{\text{min}}(\kappa_1, \kappa_n=c_2)} \approx \frac{\ln(4c_2)}{\ln(4c_1)} \tag{3}
$$
- Substituting $\kappa_n=c_1 = 10$ and $\kappa_n=c_2=100$ in Eq. 3 we get
$$
    r_{\text{th}} \approx \frac{\ln(400)}{\ln(40)} \approx 1.62
$$
- We verify this by looking at the [performance plot](../figures/performance_vs_condition_number.pdf) we see that $p_{\text{min}}(\kappa_1,\kappa_n=10)\approx 0.5$ and $p_{\text{min}}(\kappa_1,\kappa_n=100)\approx 0.3$. So $r_{\text{exp}} \approx 1.66$
## Upcoming work
- Check construction of coefficient function $\leftarrow$ should be constant on all elements
- Check sharpness compared to actual number of CG iterations
- Study case edge based coefficient functions
- Can we explain scalability with bad condition numbers?

