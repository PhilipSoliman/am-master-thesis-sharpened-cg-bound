\chapter{Results}\label{ch:results}
In this chapter we present and discuss two experiments with the sharpened CG iteration bounds from \cref{alg:multi_cluster_cg_bound,alg:multi_tail_cluster_cg_bound} applied to the approximate eigenspectra calculated as a by-product of the PCG method applied to \cref{prob:elliptic_problem_discretized}. The first experiment in \cref{sec:sharpness_of_bounds} tests the absolute sharpness of the new bounds as compared to the actual number of CG iterations required for convergence given a residual error tolerance $\epsilon_r$. Where the first experiment presumes a full spectrum to be available at the time of calculating the new bounds, this is usually not the case in practice. Therefore, the second experiment in \cref{sec:early_estimation_of_iterations} investigates the capability of the new bounds to predict the number of CG iterations required for convergence, but based on approximate spectra obtained in the first $N_{\text{iter}}$ iterations. Each experiment is conducted on the same set of meshes $\mathcal{Q}$, using the preconditioners from $\mathcal{M}^{-1}$ and for at least the two coefficient functions $\mathcal{C}_{\text{3layer, vert}}$ and $\mathcal{C}_{\text{edge slabs, around vertices}}$ as described in \cref{ch:implementation}.

\section{Sharpness of bounds}\label{sec:sharpness_of_bounds}
Here we run the PCG method from \cref{alg:pcg_left} until we achieve convergence in the sense of \cref{th:residual_convergence_criterion} with $\epsilon_r=10^{-8}$. Every iteration we store the CG coefficients $\alpha,\beta$ such that at convergence we can construct the Lanczos matrix $T_m$ using \cref{eq:cg_lanczos_eta,eq:cg_lanczos_delta,eq:lanczos_tridiagonal}. Then, we calculate all eigenvalues of $T_m$, also known as \textit{Ritz} values. The eigenvalue spectrum $\sigma(T_m)$ at convergence of the PCG method is a \textit{good} approximation of the spectrum $\sigma(M^{-1}A)$. Therefore, we can use $\sigma(T_m)$ as input for the multi-cluster and multi-tail-cluster CG iteration bounds from \cref{alg:multi_cluster_cg_bound,alg:multi_tail_cluster_cg_bound} and study how well the bounds match the actual number of CG iterations required for convergence $m$.

Before we present the iteration bounds, we show in \cref{fig:partitioning_eigenspectrum,fig:partitioning_eigenspectrum_tails} the output of \newline$\operatorname{PartitionEigenspectrum}$ and $\operatorname{PartitionEigenspectrumTails}$ from \cref{alg:partition_eigenspectrum,alg:partition_eigenspectrum_tails} corresponding to the CG iteration bounds from \cref{alg:multi_cluster_cg_bound,alg:multi_tail_cluster_cg_bound} respectively. We observe that where the multi-cluster partitioning \cref{alg:partition_eigenspectrum} consistently splits the eigenspectra $\sigma(M^{-1}A) \ \forall M^{-1} \in\mathcal{M}^{-1}$ into two clusters, the multi-tail-cluster partitioning  \cref{alg:partition_eigenspectrum_tails} partitions the eigenspectrum into either one or two tail clusters and/or one regular cluster, depending on the coarse mesh size $H$.

For instance, consider the partitioning of the eigenspectrum $\sigma(M_{\text{2-OAS-AMS}}^{-1}A)$ for the mesh $Q_{1/4}$ and coefficient function $\mathcal{C}_{\text{3layer, vert}}$ among \cref{fig:partitioning_eigenspectrum,fig:partitioning_eigenspectrum_tails}. $\operatorname{PartitionEigenspectrum}$ does not split $\sigma(M_{\text{2-OAS-AMS}}^{-1}A)$ and simply returns the extremal eigenvalues. In contrast, $\operatorname{PartitionEigenspectrumTails}$ finds two tail clusters, resulting in an output that consists exclusively of tail eigenvalues. In regard to the CG iteration bounds, this means that $m_{N_{\text{cluster}}} = m_1$ and $m_{N_{\text{tail-cluster}}} = m$. That is, the multi-cluster bound is equal to the classical bound, while the multi-tail-cluster bound is equal to the actual number of CG iterations required for convergence.
\begin{figure}[H]
    \centering
    \includegraphics{spectra_multi_cluster.pdf}
    \caption{Partition of the eigenspectrum $\sigma(T_m)\approx\sigma(M^{-1}A)$ for $M^{-1}\in\mathcal{M}$ into clusters using the multi-cluster partitioning \cref{alg:partition_eigenspectrum}. The left and right columns correspond to coarse meshes $Q_{1/4}$ and $Q_{1/64}$ and the first and second row correspond to the coefficient functions $\mathcal{C}_{\text{3layer, vert}}$ and $\mathcal{C}_{\text{edge slabs, around vertices}}$ respectively. Every spectrum's condition number is plotted to the right of it as well as the number of PCG iterations $m$ required for convergence. Eigenvalues are shown as crosses and clusters are indicated using square brackets.}
    \label{fig:partitioning_eigenspectrum}
\end{figure}

Another interesting observation can be made when comparing the output of \newline$\operatorname{PartitionEigenspectrumTails}$ given of the eigenspectrum $\sigma(M_{\text{2-OAS-RGDSW}}^{-1}A)$ for coefficient function $\mathcal{C}_{\text{3layer, vert}}$ among meshes $Q_{1/4}$ and $Q_{1/64}$ in \cref{fig:partitioning_eigenspectrum_tails}. For the mesh $Q_{1/4}$, $\operatorname{PartitionEigenspectrumTails}$ finds two tail clusters and one regular cluster. For the finest mesh $Q_{1/64}$, however, it finds only one tail cluster and one regular cluster. This indicates that the second tail cluster and regular cluster are merged into one regular cluster as the mesh size $H$ decreases. The term `merged' is used here to mean that for $Q_{1/64}$ neither one of the splitting conditions in \cref{alg:partition_eigenspectrum_tails} is satisfied, i.e., the second cluster is not sufficiently separated from the third cluster by \cref{eq:threshold_inequality_explicit_expansion}, nor do the number of eigenvalues in the cluster satisfy the sparsity condition from \cref{eq:tail_cluster_bound_sparsity_condition}.
\begin{figure}[H]
    \centering
    \includegraphics{spectra_tail_cluster.pdf}
    \caption{Partition of the eigenspectrum $\sigma(T_m)\approx\sigma(M^{-1}A)$ for $M^{-1}\in\mathcal{M}$ into tail clusters using the tail-cluster partitioning algorithm \cref{alg:partition_eigenspectrum_tails}. The left and right columns correspond coarse meshes $Q_{1/4}$ and $Q_{1/64}$ and the first and second row correspond to the coefficient functions $\mathcal{C}_{\text{3layer, vert}}$ and $\mathcal{C}_{\text{edge slabs, around vertices}}$ respectively. Every spectrum's condition number is plotted to the right of it as well as the number of PCG iterations $m$ required for convergence. Eigenvalues are shown either as crosses or as circles, depending on whether they form a regular or tail cluster, respectively. Additionally, starting indices of tail clusters, $I_t$, are indicated using vertical bars `|'}
    \label{fig:partitioning_eigenspectrum_tails}
\end{figure}

In \cref{fig:cg_bounds_gdsw,fig:cg_bounds_rgdsw,fig:cg_bounds_ams} we present the CG iteration bounds $m_{N_{\text{cluster}}}, m_{N_{\text{tail-cluster}}}$ produced by \newline$\operatorname{MultiClusterCGIterationBound}$ and $\operatorname{MultiTailClusteCGIterationBound}$ from \cref{alg:multi_cluster_cg_bound,alg:multi_tail_cluster_cg_bound}, respectively. As mentioned in \cref{sec:cg_iteration_bound_algorithm}, the output of $\operatorname{PartitionEigenspectrum}$ and \newline$\operatorname{PartitionEigenspectrumTails}$ is specifically designed such that bounds $m_{N_{\text{cluster}}}, m_{N_{\text{tail-cluster}}} < m_1$. That is, no special effort is made in \cref{ch:methods} to make these bounds sharp with respect to the actual number of CG iterations $m$ required for convergence. Fortunately, for all meshes, coefficient functions and preconditioners both bounds are either of the same order $m_{N_{\text{cluster}}}, m_{N_{\text{tail-cluster}}} = \mathcal{O}(m)$ or one order higher $m_{N_{\text{cluster}}}, m_{N_{\text{tail-cluster}}} = \mathcal{O}(10m)$.
\begin{figure}[H]
    \centering
    \includegraphics{absolute_performance_2-OAS-GDSW.pdf}
    \caption{Plot of the number of CG iterations $m$ (solid, red line with small circle markers)required to achieve convergence of the solution to \cref{prob:elliptic_problem_discretized} in the sense of criterion \cref{eq:residual_convergence_criterion_r} with $\epsilon_r=10^{-8}$. The left and right columns corresponds to the $\mathcal{C}_{\text{3layer, vert}}$ and $\mathcal{C}_{\text{edge slabs, around vertices}}$ coefficient functions. Also shown are the corresponding classical $m_1$ (dashed, light-gray line with cross markers), multi-cluster $m_{N_{\text{cluster}}}$ (dotted, dark-blue line with triangle markers), and multi-tail-cluster $m_{N_{\text{tail-cluster}}}$ (dash-dotted, gold line with big circle markers) bounds for the CG method applied to the eigenspectra obtained from the Lanczos matrix convergence (Ritz values).}
    \label{fig:cg_bounds_gdsw}
\end{figure}
\begin{figure}[H]
    \centering\includegraphics{absolute_performance_2-OAS-RGDSW.pdf}
    \caption{Similar to \cref{fig:cg_bounds_gdsw}, but now for RGDSW coarse space.}
    \label{fig:cg_bounds_rgdsw}
\end{figure}
\begin{figure}[H]
    \centering\includegraphics{absolute_performance_2-OAS-AMS.pdf}
    \caption{Similar to \cref{fig:cg_bounds_gdsw}, but now for AMS coarse space.}
    \label{fig:cg_bounds_ams}
\end{figure}
Additionally, it appears $m_{N_{\text{tail-cluster}}} \lesssim m_{N_{\text{cluster}}}$. Even though this was not a design goal of the multi-tail-cluster CG iteration bound, it is a desirable property. The reason for the sharper multi-tail-cluster bound stems from the more rigorous partitioning done by $\operatorname{PartitionEigenspectrumTails}$ compared to $\operatorname{PartitionEigenspectrum}$, as shown in \cref{fig:partitioning_eigenspectrum_tails} and the related discussion above.

\section{Early estimation of CG iteration bounds}\label{sec:early_estimation_of_iterations}
We consider now a more practical setting where the eigenspectrum $\sigma(M^{-1}A)$ is not available at the time of calculating the CG iteration bounds. Instead, we assume that we only have access to an approximate eigenspectrum $\sigma(T_i)$ obtained from the Lanczos matrix $T_i$ after $i$ iterations of the PCG method. The goal is to investigate how well the multi-cluster and multi-tail-cluster CG iteration bounds can predict the number of CG iterations $m$ required for convergence based on these approximate spectra.

\subsection{Ritz value migration and convergence of bounds}\label{sec:ritz_value_migration}
To this end, we run the PCG method from \cref{alg:pcg_left} for $N_{\text{iter}}$ iterations, where $N_{\text{iter}}$ is a parameter that we can choose. Every iteration $i$, we calculate the multi-cluster and multi-tail-cluster CG iteration bounds $m_{N_{\text{cluster}}}(\sigma(T_i))$ and $m_{N_{\text{tail-cluster}}}(\sigma(T_i))$ using the approximate eigenspectrum $\sigma(T_i)$. In \cref{fig:bound_and_spectrum_vs_iterations_2-OAS-AMS,fig:bound_and_spectrum_vs_iterations_2-OAS-RGDSW} we show the convergence of the multi-cluster and multi-tail-cluster CG iteration bounds $m_{N_{\text{cluster}}}(\sigma(T_i))$ and $m_{N_{\text{tail-cluster}}}(\sigma(T_i))$ as a function of the number of iterations $i$ with $N_{\text{iter}}=300$.
\begin{figure}[H]
    \centering
    \includegraphics{bound_and_spectrum_vs_iterations_2-OAS-AMS.pdf}
    \caption{Plots of the multi-cluster CG iteration bounds $m_{N_{\text{cluster}}}$, $m_{N_{\text{tail-cluster}}}$ and $m_{\text{estimate}} = \frac{1}{2}(m_{N_{\text{cluster}}} + m_{N_{\text{tail-cluster}}})$ for the first $N_{\text{iter}}=300$, $Q_{1/64}$ and $\mathcal{C}_{\text{edge slabs, around vertices}}$ (top) together with the approximate spectra $\sigma(T_i) \approx \sigma(M^{-1}_{\text{2-OAS-AMS}}A)$ that they are obtained from (bottom). Additionally, dark-blue dashes and gold bars indicate the partitions obtained from $\operatorname{PartitionEigenspectrum}$ and $\operatorname{PartitionEigenspectrumTails}$ respectively. In the top figure the number of CG iterations $m$ required for convergence is indicated by a solid, black, horizontal line. The dashed, black curve is the identity plot of $i$. Finally, the number of CG iterations calculated by the multi-tail-cluster bound is indicated by a dashed, black, horizontal line.}
    \label{fig:bound_and_spectrum_vs_iterations_2-OAS-AMS}
\end{figure}
Most notably, we observe that in \cref{fig:bound_and_spectrum_vs_iterations_2-OAS-AMS} the multi-cluster bound converges to its final value within about 60 iterations, whereas the multi-tail-cluster bound needs almost all $m$ iterations to converge. We can understand this difference by first looking at the spectra $\sigma(T_i)$ in the bottom of \cref{fig:bound_and_spectrum_vs_iterations_2-OAS-AMS}. We notice that the first cluster eigenvalue $\lambda_1$ splits off from the right cluster, forms a single eigenvalue cluster and settles in its final position all before 30 iterations. In the next 30 iterations, the second eigenvalue $\lambda_2$ separates from the right cluster, migrates towards the left cluster and joins it. In the process, several things change in the output of $\operatorname{PartitionEigenspectrum}$. First, the right cluster expands, as a consequence of $\lambda_2$ migrating away, yet still remaining a member. Second, in its migration $\lambda_2$ eventually satisfies the threshold condition from \cref{eq:threshold_inequality_explicit_expansion} and is removed from the right cluster, resulting in a rapid decrease of the right cluster size and the temporary formation of a third, single eigenvalue cluster consisting of only $\lambda_2$. What happened to the right cluster, happens in reverse order to the left cluster as $\lambda_2$ joins the left cluster, resulting in a rapid increase of the left cluster size, followed by a slow decrease of the left cluster size as $\lambda_2$ migrates towards the left cluster's extremal eigenvalue $\lambda_1$. This results in the characteristic two-peak shape of the multi-cluster bound in \cref{fig:bound_and_spectrum_vs_iterations_2-OAS-AMS}. We deem the process of the migration of an eigenvalue from the right to the left cluster and the characteristic two-peak shape in the plot of $m_{N_{\text{cluster}}}$ as \textit{Ritz value migration}.

We are now in a position to understand the more rapid convergence of the multi-cluster bound compared to the multi-tail-cluster bound. That is, the multi-cluster bound needs at a minimum two clusters that approximate the final two clusters of the spectrum. This happens after at least two Ritz eigenvalue migrations have occurred. In contrast, the tail cluster bound never considers the left group of tail eigenvalues as a regular cluster. Consequently, the effect of the left tail eigenvalues on the multi-tail-cluster bound only becomes apparent once the left tail has gathered a \textit{sufficient} number of tail eigenvalues. Moreover, the characteristic two-peak shape corresponding to the Ritz value migration is not present in the multi-tail-cluster bound. This can be attributed to the more rigorous splitting of $\operatorname{PartitionEigenspectrumTails}$, preventing the growth and shrinkage of the right cluster and, conversely, of the left cluster. Instead, the multi-tail-cluster bound is more stable and converges to its final value in a more gradual manner, yet does so more slowly than the multi-cluster bound.
\begin{figure}[H]
    \centering
    \includegraphics{bound_and_spectrum_vs_iterations_2-OAS-RGDSW.pdf}
    \caption{Similar to \cref{fig:bound_and_spectrum_vs_iterations_2-OAS-AMS}, but now for the RGDSW coarse space.}
    \label{fig:bound_and_spectrum_vs_iterations_2-OAS-RGDSW}
\end{figure}
In \cref{fig:bound_and_spectrum_vs_iterations_2-OAS-RGDSW} we observe a similar behavior of the multi-cluster and multi-tail-cluster bounds as in \cref{fig:bound_and_spectrum_vs_iterations_2-OAS-AMS}. However, the Ritz value migration occurs at a slower rate resulting in only one, single eigenvalue left cluster being formed within the first 300 iterations. Effectively, this means that both the multi-cluster and tail-cluster bounds underestimate the number of CG iterations $m$ required for convergence.

\subsection{Comparison of bounds}\label{sec:comparison_of_bounds}
Here we utilize the results from \cref{sec:ritz_value_migration} to generate early CG iteration bounds $m_{N_{\text{cluster}}}(\sigma(T_i))$ and $m_{N_{\text{tail-cluster}}}(\sigma(T_i))$ for $i=1,\ldots,N_{\text{iter}}$, where $N_{\text{iter}}$ satisfies
\[
    N_{\text{iter}} = \min\{300, \lfloor f_{\text{iter}} m \rfloor\}, \quad f_{\text{iter}} \in (0,1],
\]
where $m$ is the final number of CG iterations required for convergence. Additionally, we use a simple algorithm that can detect temporary convergence of the extremal eigenvalues in the set of clusters that results from $\operatorname{PartitionEigenspectrum}$. That is let $K^*$ be as in \cref{sec:cg_iteration_bound_algorithm}, then we check after some specified update frequency $N_{\text{update}}$ whether the extremal eigenvalues of the clusters in $K^*$ have not changed for the last $N_{\text{update}}$ iterations
\begin{equation}
    \forall k \in K^* \quad \frac{\lambda_{k, i}}{\lambda_{k, i-N_{\text{update}}}} < 1+\tau_{\text{extremal}}, \quad i = N_{\text{update}}, 2N_{\text{update}}, \ldots, N_{\text{iter}},
    \label{eq:extremal_eigenvalue_convergence_condition}
\end{equation}
where $\tau_{\text{extremal}}$ is some tolerance parameter. If this condition is satisfied, we assume that the extremal eigenvalues of the clusters have converged, and we can use the current clusters to calculate the CG iteration bounds $m_{N_{\text{cluster}}}(\sigma(T_i))$ and $m_{N_{\text{tail-cluster}}}(\sigma(T_i))$.

The \cref{tab:cg_iteration_bound_coef=const,tab:cg_iteration_bound_coef=3lvert,tab:cg_iteration_bound_coef=slabs_around_vertices} show the results of this process for $f_{\text{iter}} = 0.6$, $N_{\text{update}} = 5$ and $\tau_{\text{extremal}} = 0.1$ for the coefficient function $\mathcal{C}_{\text{const}}$, $\mathcal{C}_{\text{3lvert}}$ and $\mathcal{C}_{\text{edge slabs, around vertices}}$, respectively.
\input{../tables/cg_iteration_bound_coef=const.tex}
\input{../tables/cg_iteration_bound_coef=3lvert.tex}
\input{../tables/cg_iteration_bound_coef=slabs_around_vertices.tex}

In \cref{tab:cg_iteration_bound_coef=const} we can see that the classical bound $m_1$ and the multi-cluster bound $m_{N_{\text{cluster}}}$ are equal to each other. That is, no additional partitioning is performed by $\operatorname{PartitionEigenspectrum}$ and the multi-cluster bound reduces to the classical bound, as discussed in \cref{sec:cg_iteration_bound_algorithm}.
On the other hand, the multi-tail-cluster bound $m_{N_{\text{tail-cluster}}}$ is equal to the actual number of CG iterations $i$ at the time of its calculation. This is a consequence of the fact that the eigenspectrum $\sigma(T_{i})$ for $i=11,16$ as in \cref{tab:cg_iteration_bound_coef=const}, is so sparse that $\operatorname{PartitionEigenspectrum}$ does not find any clusters. This is similar to the case discussed in \cref{fig:partitioning_eigenspectrum_tails} for the mesh $Q_{1/4}$ and coefficient function $\mathcal{C}_{\text{3layer, vert}}$.
Moving to the high contrast coefficient functions $\mathcal{C}_{\text{3lvert}}$ and $\mathcal{C}_{\text{edge slabs, around vertices}}$ in \cref{tab:cg_iteration_bound_coef=3lvert,tab:cg_iteration_bound_coef=slabs_around_vertices}, we can confirm that the multi-cluster bound performs better than the classical bound $m_1$ and differs from $m$ by factor of 2 to 4, that is
\begin{equation}
    km \sim m_{N_{\text{cluster}}} < m_1, \ k < 4.
    \label{eq:multi_cluster_bound_factor}
\end{equation}

Expectedly, the multi-tail-cluster bound $m_{N_{\text{tail-cluster}}}$ is too sharp to be useful in early estimation of the number of CG iterations $m$ required for convergence. However, it may still serve a purpose as part of $m_{\text{estimate}}$, see \cref{fig:bound_and_spectrum_vs_iterations_2-OAS-AMS,fig:bound_and_spectrum_vs_iterations_2-OAS-RGDSW}. Even though $m_{\text{estimate}}$ is merely a heuristic, it does seem to perform well as an early estimate of the number of CG iterations $m$ required for convergence, as evidenced by both \cref{tab:cg_iteration_bound_coef=3lvert,tab:cg_iteration_bound_coef=slabs_around_vertices}

We note that for the coefficient function $\mathcal{C}_{\text{edge slabs, around vertices}}$ in \cref{tab:cg_iteration_bound_coef=slabs_around_vertices} both bounds $m_{N_{\text{cluster}}}$, $m_{N_{\text{tail-cluster}}}$ and the heuristic $m_{\text{estimate}}$ underestimate the number of CG iterations for the preconditioner $M_{\text{2-OAS-RGDSW}}$ on the meshes $Q_{1/32}$ and $Q_{1/64}$. This happens for the same reasons as discussed in \cref{sec:ritz_value_migration}, i.e., the Ritz value migration is not yet complete, and the left cluster has not fully formed yet. For the bounds to still be useful in practice, we can simply increase the number of iterations $N_{\text{iter}}$ to allow for more Ritz value migrations to occur. Or, if this is computationally too expensive, we can still use the bounds as indications of the number of CG iterations $m$ required for convergence.

Finally, considering all \cref{tab:cg_iteration_bound_coef=const,tab:cg_iteration_bound_coef=slabs_around_vertices} at once, we can say that the multi-cluster bound $m_{N_{\text{cluster}}}$ gives the most robust early upper bound on the number of CG iterations $m$ required for convergence, assuming that one does sufficient iterations such that several Ritz values have migrated to the left cluster(s). The tail-cluster bound gives a sharper bound that is only accurate for a more developed set of Ritz eigenvalues, that is closer to the actual spectrum of $A$, as in \cref{fig:cg_bounds_gdsw,fig:cg_bounds_rgdsw,fig:cg_bounds_ams}. Be that as it may, within the first $N_{\text{iter}} = 300$ both bounds are able to distinguish between the robust preconditioners GDSW and AMS on the one side and the non-robust RGDSW on the other.